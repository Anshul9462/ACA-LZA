# Operations management considerations for Azure Container Apps

## Operations baseline for ACA

You can work toward operational excellence and customer success by properly designing your Azure Container Apps (ACA) solution with management and monitoring in mind.

### Design considerations

Consider the following factors:

- Be aware of [ACA limits](https://learn.microsoft.com/en-us/azure/container-apps/quotas).
- Be aware of ways to isolate workloads at the network, compute, monitor and data level.
- Be aware of ways to control resource consumption by workloads.
- Be aware of ways to help ACA understand the health of your workloads.
- Be aware of configuration and security implication when enabling [DAPR](https://learn.microsoft.com/en-us/azure/container-apps/dapr-overview?tabs=bicep1%2Cyaml) at ACA environment level.
- Be aware of ways to monitor and log ACA.
- Be aware of ways to use [Azure Alert](https://learn.microsoft.com/en-us/azure/container-apps/log-monitoring?tabs=bash) to proactively detect and notify ACA applications and system critical events.
- Be aware how ACA [autoscale](https://learn.microsoft.com/en-us/azure/container-apps/scale-app?pivots=azure-cli) works and how you can leverage KEDA for event based scaling. Vertical scaling isn't supported.
- Be aware of how container apps [network traffic](https://learn.microsoft.com/en-us/azure/container-apps/network-proxy) is encrypted.


### Recommendations

- Create distinct ACA environments if you need full resource isolation. Don't use revisions to create tenant specific container apps. [ACA in multitenant solution](https://learn.microsoft.com/en-us/azure/architecture/guide/multitenant/service/container-apps).

- Use [containers cpu and memory resources requests limits](https://learn.microsoft.com/en-us/azure/container-apps/containers) to manage the compute and memory resources within an ACA environment. Container default limits are 2 vCPU and 4 GiB for compute and memory respectively.

- Add health probes to your container apps. Make sure pods contain `livenessProbe`, `readinessProbe`, and `startupProbe` [ACA health probes](https://learn.microsoft.com/en-us/azure/container-apps/health-probes?tabs=arm-template).

- ACA logs consist of two different categories: 
  - Application logs generated by containers console output (stdout/stderr) messages. When Dapr is enabled, console output will contain both application container and dapr sidecar messages. Review [ACA Log monitoring](https://learn.microsoft.com/en-us/azure/container-apps/log-monitoring?tabs=bash) to understand how to query logs using log analytics.
  - System logs generated by Azure Container Apps.

   
- When Dapr is enabled, make sure to configure [daprAIInstrumentationKey](https://learn.microsoft.com/en-us/azure/container-apps/environment) at ACA environment level to visualize container apps distributed tracing in App Insight application map.

- Consider to use App Insight sdk for application telemetry as [auto-instrumentation agent](https://learn.microsoft.com/en-us/azure/container-apps/observability) is not supported yet.



## Business continuity/disaster recovery to protect and recover ACA

Your organization needs to design suitable Azure Container Apps (ACA) platform-level capabilities to meet its specific requirements. These application services have requirements related to recovery time objective (RTO) and recovery point objective (RPO).Your first step is to define a service-level agreement (SLA) for your infrastructure and application. Learn about the [SLA for Azure Container Apps](https://azure.microsoft.com/en-us/support/legal/sla/container-apps/v1_0/). See the **SLA details** section for information about monthly uptime calculations.

### Design considerations

- Azure Container Apps uses [availability zones](https://learn.microsoft.com/en-us/azure/container-apps/disaster-recovery?tabs=bash) in regions where they're available to provide high-availability protection for your applications and data from data center failures.
  - Choose a region that supports Availability Zones.
  - The environment must include a virtual network (VNET) with an available subnet.
  - To ensure proper distribution of replicas, you should configure your app's minimum and maximum replica count with values that are divisible by three. The minimum replica count should be at least three.

- In the unlikely event of a full region outage, first deploy your container apps in advance to multiple regions. Next, use [Azure Front Door](https://learn.microsoft.com/en-us/azure/frontdoor/front-door-overview) to handle incoming requests, pointing traffic to your primary region.

- Maintain engineering DevOps capabilities to reach service-level goals.


### Design recommendations

The following are best practices for your design:

- Whenever possible, remove service state from inside containers. Instead, use an Azure platform as a service (PaaS) that supports multiregion replication.

- Your applications might use [Azure Storage](https://learn.microsoft.com/en-us/azure/container-apps/storage-mounts?pivots=aca-cli) for their data. Because your applications are spread across multiple ACA environments clusters in different regions, you must keep the storage synced.

- Store your container images in [Azure Container Registry](/azure/aks/operator-best-practices-multi-region#enable-geo-replication-for-container-images) and geo-replicate the registry to each ACA region.
